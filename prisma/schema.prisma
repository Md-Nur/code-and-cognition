generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String          @id @default(cuid())
  name           String
  email          String          @unique
  passwordHash   String
  role           Role            @default(CONTRACTOR)
  createdAt      DateTime        @default(now())
  ledgerBalance  LedgerBalance?
  finderProjects Project[]       @relation("Finder")
  memberProjects ProjectMember[]
}

model Service {
  id             String          @id @default(cuid())
  title          String          @unique
  description    String
  status         Status          @default(ACTIVE)
  thumbnailUrl   String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  bookings       Booking[]
  portfolioItems PortfolioItem[]
  subCategories  SubCategory[]
}

model SubCategory {
  id             String          @id @default(cuid())
  title          String
  description    String?
  imageUrl       String?
  serviceId      String
  basePriceBDT   Float           @default(0)
  basePriceUSD   Float           @default(0)
  mediumPriceBDT Float           @default(0)
  mediumPriceUSD Float           @default(0)
  proPriceBDT    Float           @default(0)
  proPriceUSD    Float           @default(0)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  service        Service         @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  portfolioItems PortfolioItem[]
}

model PortfolioItem {
  id            String       @id @default(cuid())
  title         String
  description   String
  imageUrl      String?
  projectUrl    String?
  serviceId     String
  subCategoryId String?
  technologies  String[]
  isFeatured    Boolean      @default(false)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  service       Service      @relation(fields: [serviceId], references: [id])
  subCategory   SubCategory? @relation(fields: [subCategoryId], references: [id])
}

model Booking {
  id          String        @id @default(cuid())
  clientName  String
  clientEmail String
  clientPhone String?
  serviceId   String
  budgetBDT   Float?
  budgetUSD   Float?
  message     String?
  status      BookingStatus @default(PENDING)
  createdAt   DateTime      @default(now())
  service     Service       @relation(fields: [serviceId], references: [id])
  project     Project?
}

model Project {
  id        String          @id @default(cuid())
  title     String
  bookingId String?         @unique
  finderId  String
  status    ProjectStatus   @default(ACTIVE)
  createdAt DateTime        @default(now())
  payments  Payment[]
  booking   Booking?        @relation(fields: [bookingId], references: [id])
  finder    User            @relation("Finder", fields: [finderId], references: [id])
  members   ProjectMember[]
}

model ProjectMember {
  id        String  @id @default(cuid())
  projectId String
  userId    String
  share     Float
  project   Project @relation(fields: [projectId], references: [id])
  user      User    @relation(fields: [userId], references: [id])

  @@unique([projectId, userId])
}

model Payment {
  id        String        @id @default(cuid())
  projectId String
  amountBDT Float?
  amountUSD Float?
  currency  Currency
  note      String?
  paidAt    DateTime      @default(now())
  splits    LedgerEntry[]
  project   Project       @relation(fields: [projectId], references: [id])
}

model LedgerEntry {
  id        String    @id @default(cuid())
  paymentId String
  userId    String?
  type      SplitType
  amountBDT Float?
  amountUSD Float?
  createdAt DateTime  @default(now())
  payment   Payment   @relation(fields: [paymentId], references: [id])
}

model LedgerBalance {
  id       String @id @default(cuid())
  userId   String @unique
  totalBDT Float  @default(0)
  totalUSD Float  @default(0)
  user     User   @relation(fields: [userId], references: [id])
}

enum Role {
  FOUNDER
  CONTRACTOR
}

enum Status {
  ACTIVE
  INACTIVE
}

enum BookingStatus {
  PENDING
  REVIEWED
  CONVERTED
  REJECTED
}

enum ProjectStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum Currency {
  BDT
  USD
}

enum SplitType {
  COMPANY_FUND
  FINDER_FEE
  EXECUTION
}
