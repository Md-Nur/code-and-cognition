generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model ActivityLog {
  id        String   @id
  projectId String
  userId    String?
  action    String
  createdAt DateTime @default(now())
  Project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User      User?    @relation(fields: [userId], references: [id])
}

model Booking {
  id          String        @id
  clientName  String
  clientEmail String
  clientPhone String?
  serviceId   String
  budgetBDT   Float?
  budgetUSD   Float?
  message     String?
  status      BookingStatus @default(PENDING)
  createdAt   DateTime      @default(now())
  discovery   Json?
  proposalId  String?       @unique
  Proposal    Proposal?     @relation(fields: [proposalId], references: [id])
  Service     Service       @relation(fields: [serviceId], references: [id])
  Project     Project?
}

model ChangeRequest {
  id                    String    @id
  projectId             String
  requestedById         String
  title                 String
  description           String
  estimatedTimeImpact   Float     @default(0)
  estimatedBudgetImpact Float     @default(0)
  status                CRStatus  @default(PENDING)
  clientApprovalAt      DateTime?
  createdAt             DateTime  @default(now())
  Project               Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User                  User      @relation(fields: [requestedById], references: [id])
}

model Client {
  id        String   @id
  name      String
  logoUrl   String
  website   String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model EngagementModel {
  id            String      @id
  serviceId     String
  name          String
  description   String
  pricingType   PricingType @default(CUSTOM)
  basePriceBDT  Float?
  basePriceUSD  Float?
  deliverables  String[]
  estimatedDays Int?
  order         Int         @default(0)
  status        Status      @default(ACTIVE)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime
  Service       Service     @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  Proposal      Proposal[]

  @@unique([serviceId, name])
}

model Expense {
  id        String   @id
  title     String
  amountBDT Float
  amountUSD Float?
  category  String?
  date      DateTime @default(now())
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model LedgerBalance {
  id       String @id
  userId   String @unique
  totalBDT Float  @default(0)
  totalUSD Float  @default(0)
  User     User   @relation(fields: [userId], references: [id])
}

model LedgerEntry {
  id        String    @id
  paymentId String
  userId    String?
  type      SplitType
  amountBDT Float?
  amountUSD Float?
  createdAt DateTime  @default(now())
  Payment   Payment   @relation(fields: [paymentId], references: [id])
}

model Message {
  id                            String   @id
  content                       String
  senderId                      String
  receiverId                    String
  isRead                        Boolean  @default(false)
  createdAt                     DateTime @default(now())
  User_Message_receiverIdToUser User     @relation("Message_receiverIdToUser", fields: [receiverId], references: [id])
  User_Message_senderIdToUser   User     @relation("Message_senderIdToUser", fields: [senderId], references: [id])
}

model Milestone {
  id          String          @id
  projectId   String
  title       String
  description String?
  order       Int             @default(0)
  status      MilestoneStatus @default(PENDING)
  completedAt DateTime?
  createdAt   DateTime        @default(now())
  updatedAt   DateTime
  Project     Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Notification {
  id        String           @id
  userId    String
  title     String
  message   String
  type      NotificationType
  link      String?
  isRead    Boolean          @default(false)
  createdAt DateTime         @default(now())
  User      User             @relation(fields: [userId], references: [id])
}

model Payment {
  id          String        @id
  projectId   String
  amountBDT   Float?
  amountUSD   Float?
  currency    Currency
  note        String?
  paidAt      DateTime      @default(now())
  LedgerEntry LedgerEntry[]
  Project     Project       @relation(fields: [projectId], references: [id])
}

model PortfolioItem {
  id           String   @id
  title        String
  description  String
  imageUrl     String?
  projectUrl   String?
  serviceId    String
  technologies String[]
  isFeatured   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  Service      Service  @relation(fields: [serviceId], references: [id])
}

model Project {
  id            String          @id
  title         String
  bookingId     String?         @unique
  finderId      String
  status        ProjectStatus   @default(ACTIVE)
  health        ProjectHealth   @default(GREEN)
  viewToken     String?         @unique
  scope         String?
  startDate     DateTime?
  endDate       DateTime?
  riskNotes     String?
  createdAt     DateTime        @default(now())
  ActivityLog   ActivityLog[]
  ChangeRequest ChangeRequest[]
  Milestone     Milestone[]
  Payment       Payment[]
  Booking       Booking?        @relation(fields: [bookingId], references: [id])
  User          User            @relation(fields: [finderId], references: [id])
  ProjectMember ProjectMember[]
  Proposal      Proposal[]
}

model ProjectMember {
  id        String  @id
  projectId String
  userId    String
  share     Float
  Project   Project @relation(fields: [projectId], references: [id])
  User      User    @relation(fields: [userId], references: [id])

  @@unique([projectId, userId])
}

model Proposal {
  id                String           @id
  projectId         String?
  engagementModelId String?
  scopeSummary      String
  deliverables      String[]
  budgetBDT         Float?
  budgetUSD         Float?
  currency          Currency         @default(BDT)
  estimatedDays     Int?
  approved          Boolean          @default(false)
  approvedAt        DateTime?
  notes             String?
  version           Int              @default(1)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime
  milestones        String[]
  status            ProposalStatus   @default(DRAFT)
  Booking           Booking?
  EngagementModel   EngagementModel? @relation(fields: [engagementModelId], references: [id])
  Project           Project?         @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Service {
  id              String            @id
  categoryId      String
  title           String            @unique
  slug            String            @unique
  description     String
  overview        String?
  positioningText String?
  status          Status            @default(ACTIVE)
  thumbnailUrl    String?
  order           Int               @default(0)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  Booking         Booking[]
  EngagementModel EngagementModel[]
  PortfolioItem   PortfolioItem[]
  ServiceCategory ServiceCategory   @relation(fields: [categoryId], references: [id])
}

model ServiceCategory {
  id          String    @id
  name        String    @unique
  description String
  slug        String    @unique
  order       Int       @default(0)
  status      Status    @default(ACTIVE)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  Service     Service[]
}

model Testimonial {
  id        String   @id
  name      String
  role      String?
  company   String?
  content   String
  avatarUrl String?
  rating    Int      @default(5)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model User {
  id                               String          @id
  name                             String
  email                            String          @unique
  passwordHash                     String
  role                             Role            @default(CONTRACTOR)
  createdAt                        DateTime        @default(now())
  ActivityLog                      ActivityLog[]
  ChangeRequest                    ChangeRequest[]
  LedgerBalance                    LedgerBalance?
  Message_Message_receiverIdToUser Message[]       @relation("Message_receiverIdToUser")
  Message_Message_senderIdToUser   Message[]       @relation("Message_senderIdToUser")
  Notification                     Notification[]
  Project                          Project[]
  ProjectMember                    ProjectMember[]
}

enum BookingStatus {
  PENDING
  REVIEWED
  CONVERTED
  REJECTED
}

enum CRStatus {
  PENDING
  APPROVED
  REJECTED
}

enum Currency {
  BDT
  USD
}

enum MilestoneStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
}

enum NotificationType {
  BOOKING_NEW
  BOOKING_STATUS_CHANGE
  PROJECT_NEW
  PROJECT_STATUS_CHANGE
  MESSAGE_NEW
  PAYMENT_RECEIVED
  SYSTEM
}

enum PricingType {
  FIXED
  CUSTOM
  RETAINER
}

enum ProjectHealth {
  GREEN
  YELLOW
  RED
}

enum ProjectStatus {
  ACTIVE
  COMPLETED
  CANCELLED
}

enum ProposalStatus {
  DRAFT
  SENT
  APPROVED
  REJECTED
}

enum Role {
  FOUNDER
  CONTRACTOR
  CLIENT
}

enum SplitType {
  COMPANY_FUND
  FINDER_FEE
  EXECUTION
}

enum Status {
  ACTIVE
  INACTIVE
}
